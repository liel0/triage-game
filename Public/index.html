<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Triage Drone 2040 ‚Äì Control Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #040814;
      --panel: #0b1020;
      --accent: #3fbcff;
      --accent-soft: rgba(63, 188, 255, 0.18);
      --danger: #ff4b5c;
      --warning: #ffc857;
      --success: #22c55e;
      --muted: #9ca3af;
      --muted-soft: rgba(148, 163, 184, 0.5);
      --text: #f9fafb;
      --card-radius: 18px;
      --scan-pill: rgba(17, 24, 39, 0.9);
      --scan-pill-border: rgba(148, 163, 184, 0.28);
      --scan-pill-glow: rgba(56, 189, 248, 0.9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 38%, #000 100%);
      color: var(--text);
      overflow: hidden;
    }

    .root {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      padding: 12px 18px;
      gap: 10px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, #020617, #020617, #020617);
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 14px;
    }

    header .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 600;
    }

    header .title span {
      font-size: 20px;
    }

    header .subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    header .operator {
      font-size: 14px;
      color: var(--muted);
    }

    .glow {
      text-shadow: 0 0 10px rgba(56, 189, 248, 0.9);
    }

    main {
      flex: 1;
      display: grid;
      grid-template-rows: 60% 40%;
      gap: 10px;
      min-height: 0;
    }

    .top-row {
      display: grid;
      grid-template-columns: 58% 42%;
      gap: 10px;
      min-height: 0;
    }

    .bottom-row {
      display: grid;
      grid-template-columns: 58% 42%;
      gap: 10px;
      min-height: 0;
    }

    .panel {
      background: radial-gradient(circle at top left, #111827 0, #020617 55%);
      border-radius: var(--card-radius);
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 14px 16px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.8);
      min-height: 0;
      overflow: hidden;
    }

    .panel h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e5f3ff;
    }

    .panel h2::before {
      content: "";
      width: 4px;
      height: 16px;
      border-radius: 999px;
      background: linear-gradient(180deg, #38bdf8, #22c55e);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
    }

    /* BODY MAP + SILHOUETTE */

    .body-layout {
      display: grid;
      grid-template-columns: minmax(0, 60%) minmax(0, 40%);
      gap: 12px;
      height: calc(100% - 40px);
      align-items: stretch;
    }

    .scan-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 4px;
    }

    .scan-row {
      background: var(--scan-pill);
      border-radius: 999px;
      border: 1px solid var(--scan-pill-border);
      padding: 6px 12px;
      min-height: 42px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: border-color 0.18s ease-out, box-shadow 0.18s ease-out,
        background 0.18s ease-out;
    }

    .scan-row-header {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
    }

    .scan-label {
      font-weight: 500;
      color: #e5e7eb;
    }

    .scan-status {
      font-size: 11px;
      color: var(--muted);
    }

    .scan-row.scanned {
      border-color: var(--scan-pill-glow);
      box-shadow: 0 0 16px rgba(56, 189, 248, 0.6);
      background: radial-gradient(circle at left, rgba(56, 189, 248, 0.15), #020617);
    }

    .scan-row.scanned .scan-status {
      color: #a5f3fc;
    }

    .scan-instructions {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
    }

    .scan-instructions strong {
      color: #a5f3fc;
    }

    .scan-instructions ol {
      margin-top: 2px;
      padding-left: 12px;
    }

    .scan-instructions li {
      margin-top: 2px;
    }

    /* Silhouette */

    .silhouette-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .silhouette-container {
      position: relative;
      width: 170px;
      height: 430px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #0f172a 0, #020617 70%);
      border: 1px solid rgba(15, 23, 42, 0.9);
      box-shadow: 0 22px 60px rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .silhouette-shell {
      position: absolute;
      inset: 10px 12px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #020617 0, #020617 100%);
    }

    .silhouette-body {
      position: absolute;
      inset: 26px 40px 52px;
      border-radius: 999px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      pointer-events: none;
    }

    .silhouette-part {
      background: radial-gradient(circle at top, #0b1220 0, #020617 80%);
      border-radius: 999px;
      opacity: 0.2;
      transition: opacity 0.24s ease-out, box-shadow 0.24s ease-out,
        background 0.24s ease-out;
      box-shadow: 0 0 0 rgba(56, 189, 248, 0);
    }

    .silhouette-part.head {
      width: 40px;
      height: 40px;
    }

    .silhouette-part.torso {
      width: 68px;
      height: 90px;
    }

    .silhouette-part.hips {
      width: 52px;
      height: 70px;
    }

    .silhouette-part.legs {
      width: 28px;
      height: 100px;
    }

    .silhouette-part arms {
      width: 14px;
      height: 90px;
    }

    .silhouette-part.glow {
      opacity: 0.9;
      background: radial-gradient(circle at top, #1d4ed8 0, #22c55e 70%);
      box-shadow: 0 14px 40px rgba(56, 189, 248, 0.9);
    }

    /* horizontal scan bands behind body */

    .silhouette-band {
      position: absolute;
      left: 7px;
      right: 7px;
      height: calc(100% / 7);
      border-radius: 999px;
      background: radial-gradient(circle at left, #020617 0, #020617 100%);
      box-shadow: inset 0 0 0 rgba(15, 23, 42, 0.8);
      opacity: 0.35;
      transform-origin: center;
      transition: opacity 0.24s ease-out, box-shadow 0.24s ease-out,
        transform 0.24s ease-out;
    }

    .silhouette-band:nth-child(1) { top: 4px; }
    .silhouette-band:nth-child(2) { top: calc(4px + (100% / 7) * 1 - 8px); }
    .silhouette-band:nth-child(3) { top: calc(4px + (100% / 7) * 2 - 8px); }
    .silhouette-band:nth-child(4) { top: calc(4px + (100% / 7) * 3 - 8px); }
    .silhouette-band:nth-child(5) { top: calc(4px + (100% / 7) * 4 - 8px); }
    .silhouette-band:nth-child(6) { top: calc(4px + (100% / 7) * 5 - 8px); }
    .silhouette-band:nth-child(7) { top: calc(4px + (100% / 7) * 6 - 8px); }

    .silhouette-band.scanned {
      opacity: 0.9;
      box-shadow: 0 0 28px rgba(56, 189, 248, 0.8);
      background: radial-gradient(circle at left, rgba(56, 189, 248, 0.4), #020617);
      transform: scaleX(1.02);
    }

    .silhouette-caption {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      max-width: 190px;
    }

    .silhouette-caption strong {
      color: #bae6fd;
    }

    /* VITALS PANEL */

    .vitals-list {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
    }

    .vital-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      border-bottom: 1px dashed rgba(51, 65, 85, 0.7);
      padding: 4px 0;
    }

    .vital-label {
      color: var(--muted);
    }

    .vital-value {
      font-weight: 600;
    }

    .vital-value.critical {
      color: #fecaca;
    }

    .vital-value.warning {
      color: #fde68a;
    }

    .vital-value.ok {
      color: #bbf7d0;
    }

    .timer {
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .timer span.time {
      font-weight: 700;
      font-size: 18px;
    }

    .timer-hint {
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }

    .coming-soon {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.75);
      font-size: 12px;
      color: var(--muted);
    }

    .coming-soon-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #fed7aa;
      margin-bottom: 4px;
    }

    /* TRIAGE PANEL */

    .triage-panel h2 {
      margin-bottom: 6px;
    }

    .triage-panel-sub {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .triage-grid {
      display: grid;
      grid-template-columns: minmax(0, 55%) minmax(0, 45%);
      gap: 12px;
      height: calc(100% - 40px);
      align-items: flex-start;
    }

    .triage-left {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .triage-right {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .triage-step-label {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .triage-circles {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 6px;
    }

    .triage-circle {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        border-color 0.12s ease-out;
    }

    .triage-circle[data-level="Red"] {
      background: radial-gradient(circle at top, #f97373, #b91c1c);
    }

    .triage-circle[data-level="Yellow"] {
      background: radial-gradient(circle at top, #facc15, #b45309);
    }

    .triage-circle[data-level="Green"] {
      background: radial-gradient(circle at top, #4ade80, #15803d);
    }

    .triage-circle[data-level="Black"] {
      background: #020617;
      border: 1px solid #6b7280;
    }

    .triage-circle span {
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      white-space: nowrap;
      color: var(--muted);
    }

    .triage-circle.selected {
      transform: scale(1.08);
      box-shadow: 0 0 18px rgba(94, 234, 212, 0.8);
      border-color: #e5e7eb;
    }

    .hospital-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hospital-card {
      border-radius: 16px;
      padding: 8px 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.92);
      cursor: pointer;
      font-size: 13px;
    }

    .hospital-name {
      font-weight: 600;
      margin-bottom: 3px;
      color: #e0f2fe;
    }

    .hospital-meta {
      font-size: 11px;
      color: var(--muted);
    }

    .hospital-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 16px rgba(59, 130, 246, 0.7);
      background: radial-gradient(circle at left, rgba(56, 189, 248, 0.18), #020617);
    }

    .tests-container {
      margin-top: 4px;
      padding: 8px 10px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.96);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 12px;
    }

    .test-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 4px 10px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
    }

    .test-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
    }

    .test-pill.selected {
      border-color: var(--accent);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.3), #020617);
      box-shadow: 0 0 14px rgba(56, 189, 248, 0.6);
    }

    .test-pill.selected span.dot {
      background: #22c55e;
    }

    .triage-buttons-row {
      margin-top: auto;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
    }

    .btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      color: white;
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.5);
    }

    .btn-secondary-soft {
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      box-shadow: none;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    /* RESULTS + LEADERBOARD */

    .results-table {
      width: 100%;
      font-size: 12px;
      border-collapse: collapse;
      margin-top: 2px;
    }

    .results-table th,
    .results-table td {
      padding: 4px 6px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.5);
      text-align: left;
    }

    .results-table th {
      font-weight: 600;
      color: var(--muted);
    }

    .match-cell {
      text-align: center;
      font-size: 14px;
    }

    .match-yes {
      color: #4ade80;
    }

    .match-no {
      color: #f97373;
    }

    .score-summary {
      margin-top: 6px;
      font-size: 13px;
      color: #e0f2fe;
    }

    .score-summary span.points {
      color: #bbf7d0;
    }

    .score-summary span.badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(52, 211, 153, 0.7);
      background: rgba(6, 78, 59, 0.6);
      margin-left: 6px;
    }

    .leaderboard {
      margin-top: 10px;
      font-size: 12px;
    }

    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .leaderboard-header-title {
      font-weight: 600;
    }

    .leaderboard-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .leaderboard table {
      width: 100%;
      border-collapse: collapse;
    }

    .leaderboard th,
    .leaderboard td {
      padding: 3px 4px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.4);
      text-align: left;
    }

    .leaderboard th {
      font-weight: 600;
      color: var(--muted);
    }

    .btn-small {
      padding: 4px 10px;
      font-size: 11px;
    }
  </style>
</head>
<body>
<div class="root">
  <header>
    <div class="title">
      <span>üöÅ</span>
      <div>
        <div>AI Triage Drone 2040</div>
        <div class="subtitle">Mass casualty triage training ‚Ä¢ Human vs AI</div>
      </div>
    </div>
    <div class="operator" id="operatorLabel">
      Operator: Waiting for mobile operator‚Ä¶
    </div>
  </header>

  <main>
    <!-- TOP ROW -->
    <div class="top-row">
      <!-- BODY MAP + SILHOUETTE -->
      <section class="panel" id="bodyPanel">
        <h2>Patient Body Map &amp; Drone Feed</h2>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
          <div class="pill">
            Scenario
            <select id="scenarioSelect" style="background:transparent;border:none;color:#e5e7eb;font-size:12px;outline:none;">
            </select>
          </div>
          <span style="font-size:11px;color:var(--muted);">
            Scan order: eyes ‚Üí face ‚Üí neck ‚Üí chest ‚Üí arms ‚Üí pelvis ‚Üí legs
          </span>
        </div>

        <div class="body-layout">
          <div class="scan-list" id="scanList">
            <!-- rows injected -->
          </div>

            <div class="silhouette-wrap">
              <div class="silhouette-container">
                <div class="silhouette-shell"></div>
                <!-- 7 horizontal bands -->
                <div class="silhouette-band" data-band="0"></div>
                <div class="silhouette-band" data-band="1"></div>
                <div class="silhouette-band" data-band="2"></div>
                <div class="silhouette-band" data-band="3"></div>
                <div class="silhouette-band" data-band="4"></div>
                <div class="silhouette-band" data-band="5"></div>
                <div class="silhouette-band" data-band="6"></div>

                <!-- simple body made from 4 parts -->
                <div class="silhouette-body">
                  <div class="silhouette-part head" data-part="head"></div>
                  <div class="silhouette-part torso" data-part="torso"></div>
                  <div class="silhouette-part hips" data-part="hips"></div>
                  <div class="silhouette-part legs" data-part="legs"></div>
                </div>
              </div>
              <div class="silhouette-caption">
                Scan from <strong>head to toe</strong>. Each scan lights one band. When all bands are glowing, continue to triage.
              </div>
            </div>
        </div>

        <div class="scan-instructions">
          Scan in this order:
          <ol>
            <li><strong>Eyes / ID</strong> ‚Äì demographics tag</li>
            <li><strong>Face</strong> ‚Äì consciousness level</li>
            <li><strong>Neck</strong> ‚Äì heart rate</li>
            <li><strong>Chest</strong> ‚Äì respiratory rate</li>
            <li><strong>Arms</strong> ‚Äì blood pressure (not used in Scenario 4)</li>
            <li><strong>Pelvis / Abdomen</strong> ‚Äì main injury</li>
            <li><strong>Legs / Feet</strong> ‚Äì secondary injury</li>
          </ol>
        </div>
      </section>

      <!-- VITALS PANEL -->
      <section class="panel">
        <h2>Live Vitals (from drone)</h2>
        <div class="vitals-list">
          <div class="vital-row">
            <div class="vital-label">Consciousness</div>
            <div class="vital-value critical" id="vConsciousness">‚Äî</div>
          </div>
          <div class="vital-row">
            <div class="vital-label">Respiratory rate (RR)</div>
            <div class="vital-value warning" id="vRR">‚Äî</div>
          </div>
          <div class="vital-row">
            <div class="vital-label">Heart rate (HR)</div>
            <div class="vital-value warning" id="vHR">‚Äî</div>
          </div>
          <div class="vital-row">
            <div class="vital-label">Blood pressure (BP)</div>
            <div class="vital-value critical" id="vBP">‚Äî</div>
          </div>
          <div class="vital-row">
            <div class="vital-label">Key injury / problem</div>
            <div class="vital-value critical" id="vKeyInjury">‚Äî</div>
          </div>
        </div>

        <div class="timer">
          <div>PATIENT LOADING ‚Ä¢ TRIAGE TIMER</div>
          <span class="time" id="timerDisplay">0.00 s</span>
        </div>
        <div class="timer-hint" id="timerHint">
          Scan all QR tags on the mannequin. The timer will start when you continue to triage.
        </div>

        <div class="coming-soon">
          <div class="coming-soon-title">COMING SOON ‚Ä¢ AI Paramedic Support Module</div>
          <div style="font-size:12px;">
            Drone will recommend the exact medical tools paramedics should bring from the hospital based on the injuries.
          </div>
        </div>
      </section>
    </div>

    <!-- BOTTOM ROW -->
    <div class="bottom-row">
      <!-- TRIAGE DECISION -->
      <section class="panel triage-panel">
        <h2>Human Triage Decision</h2>
        <div class="triage-panel-sub">
          Complete triage only after <strong>all scans are done</strong>. Then submit to compare with the AI.
        </div>
        <div class="triage-grid">
          <div class="triage-left">
            <div>
              <div class="triage-step-label">Step 1 ‚Äî Choose triage category</div>
              <div class="triage-circles">
                <div class="triage-circle" data-level="Red">
                  <span>RED<br/><small>Immediate</small></span>
                </div>
                <div class="triage-circle" data-level="Yellow">
                  <span>YELLOW<br/><small>Urgent</small></span>
                </div>
                <div class="triage-circle" data-level="Green">
                  <span>GREEN<br/><small>Minimal</small></span>
                </div>
                <div class="triage-circle" data-level="Black">
                  <span>BLACK<br/><small>Expectant</small></span>
                </div>
              </div>
            </div>

            <div>
              <div class="triage-step-label" style="margin-top:8px;">Step 2 ‚Äî Choose receiving hospital</div>
              <div class="hospital-list" id="hospitalList"></div>
            </div>
          </div>

          <div class="triage-right">
            <div>
              <div class="triage-step-label">Step 3 ‚Äî Choose ER tests</div>
              <div class="tests-container" id="testsList"></div>
            </div>

            <div class="triage-buttons-row">
              <span id="decisionHint">Scan all regions, then continue to triage.</span>
              <button class="btn btn-secondary-soft" id="continueBtn" disabled>Continue to triage</button>
              <button class="btn btn-primary" id="submitDecisionBtn" disabled>Submit decision</button>
            </div>
          </div>
        </div>
      </section>

      <!-- RESULTS + LEADERBOARD -->
      <section class="panel">
        <h2>Human vs AI Results</h2>

        <table class="results-table">
          <thead>
          <tr>
            <th>Category</th>
            <th>Human</th>
            <th>AI</th>
            <th class="match-cell">Match</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>Triage</td>
            <td id="resHumanTriage">‚Äî</td>
            <td id="resAITriage">‚Äî</td>
            <td class="match-cell" id="matchTriage">‚Äî</td>
          </tr>
          <tr>
            <td>Hospital</td>
            <td id="resHumanHospital">‚Äî</td>
            <td id="resAIHospital">‚Äî</td>
            <td class="match-cell" id="matchHospital">‚Äî</td>
          </tr>
          <tr>
            <td>ER tests</td>
            <td id="resHumanTests">‚Äî</td>
            <td id="resAITests">‚Äî</td>
            <td class="match-cell" id="matchTests">‚Äî</td>
          </tr>
          <tr>
            <td>Time</td>
            <td id="resHumanTime">‚Äî</td>
            <td id="resAITime">‚Äî</td>
            <td class="match-cell" id="matchTime">‚Äî</td>
          </tr>
          </tbody>
        </table>

        <div class="score-summary" id="scoreSummary">
          Score: <span class="points">0 / 12</span> points
        </div>

        <div class="leaderboard">
          <div class="leaderboard-header">
            <div class="leaderboard-header-title">Live Leaderboard</div>
            <div class="leaderboard-actions">
              <button class="btn btn-secondary-soft btn-small" id="resetSimulationBtn">Reset simulation</button>
              <button class="btn btn-primary btn-small" style="background:linear-gradient(135deg,#ef4444,#f97316);" id="resetLeaderboardBtn">
                Reset board
              </button>
            </div>
          </div>
          <table>
            <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Mode</th>
              <th>Scenario</th>
              <th>Score</th>
              <th>Time</th>
            </tr>
            </thead>
            <tbody id="leaderboardBody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const LS_LEADERBOARD_KEY = "aiTriageDroneLeaderboard_v2";

  const scanSlots = [
    { id: "eyes", label: "Eyes / ID" },
    { id: "face", label: "Face ‚Äì Consciousness" },
    { id: "neck", label: "Neck ‚Äì Heart rate" },
    { id: "chest", label: "Chest ‚Äì Respiratory rate" },
    { id: "arms", label: "Arms ‚Äì Blood pressure" },
    { id: "pelvis", label: "Pelvis / Abdomen ‚Äì Injury 1" },
    { id: "legs", label: "Legs / Feet ‚Äì Injury 2" }
  ];

  const scenarios = [
    {
      id: "s1",
      label: "Scenario 1 ‚Äî Hajj Stampede (Red)",
      expectedScans: 7,
      ai: {
        triage: "Red",
        hospital: "Mina Emergency Hospital",
        erTests: ["FAST ultrasound", "Serum lactate", "Blood typing and crossmatch"],
        timeSeconds: 1.2
      },
      vitalsBySlot: {
        eyes: { vitalKey: "consciousness", value: "Unconscious, pale, shallow breathing" },
        face: null,
        neck: { vitalKey: "hr", value: "142 bpm" },
        chest: { vitalKey: "rr", value: "34 / min" },
        arms: { vitalKey: "bp", value: "78/45 mmHg" },
        pelvis: { vitalKey: "keyInjury", value: "Severe bleeding from lower abdomen" },
        legs: null
      },
      hospitals: [
        {
          name: "Mina Emergency Hospital",
          meta: "Closest high-emergency facility",
          testsAvailable: [
            "FAST ultrasound",
            "Serum lactate",
            "Blood typing and crossmatch",
            "D-dimer",
            "Urinalysis"
          ]
        },
        {
          name: "King Fahad Medical City ‚Äî Trauma Centre",
          meta: "Level 1 trauma centre, Riyadh",
          testsAvailable: [
            "FAST ultrasound",
            "Serum lactate",
            "Blood typing and crossmatch",
            "CT head (non-contrast)",
            "D-dimer"
          ]
        },
        {
          name: "Dhahran Trauma Center",
          meta: "Highway critical care hub",
          testsAvailable: [
            "FAST ultrasound",
            "Serum lactate",
            "CT head (non-contrast)",
            "D-dimer"
          ]
        }
      ]
    },
    {
      id: "s2",
      label: "Scenario 2 ‚Äî Industrial Explosion (Yellow)",
      expectedScans: 7,
      ai: {
        triage: "Yellow",
        hospital: "King Fahad Medical City ‚Äî Trauma Centre",
        erTests: ["Plain X-ray", "Carboxyhaemoglobin level (CO)", "Burn depth assessment"],
        timeSeconds: 1.4
      },
      vitalsBySlot: {
        eyes: { vitalKey: "consciousness", value: "Alert but disoriented" },
        face: null,
        neck: { vitalKey: "hr", value: "110 bpm" },
        chest: { vitalKey: "rr", value: "26 / min" },
        arms: { vitalKey: "bp", value: "100/70 mmHg" },
        pelvis: { vitalKey: "keyInjury", value: "Burns, chest tightness, dizziness" },
        legs: null
      },
      hospitals: [
        {
          name: "King Fahad Medical City ‚Äî Trauma Centre",
          meta: "Level 1 trauma centre",
          testsAvailable: [
            "Plain X-ray",
            "Carboxyhaemoglobin level (CO)",
            "Burn depth assessment",
            "ECG",
            "D-dimer"
          ]
        },
        {
          name: "Mina Emergency Hospital",
          meta: "Mass-casualty capable unit",
          testsAvailable: [
            "Plain X-ray",
            "Burn depth assessment",
            "Urinalysis"
          ]
        },
        {
          name: "Dhahran Trauma Center",
          meta: "High-capacity burn and trauma",
          testsAvailable: [
            "Plain X-ray",
            "CT scan",
            "Burn depth assessment",
            "D-dimer"
          ]
        }
      ]
    },
    {
      id: "s3",
      label: "Scenario 3 ‚Äî Desert Rally (Green)",
      expectedScans: 7,
      ai: {
        triage: "Green",
        hospital: "AlUla Field Medical Base",
        erTests: ["Plain X-ray", "Intravenous (IV) fluids", "FAST ultrasound"],
        timeSeconds: 1.5
      },
      vitalsBySlot: {
        eyes: { vitalKey: "consciousness", value: "Walking, answering appropriately" },
        face: null,
        neck: { vitalKey: "hr", value: "92 bpm" },
        chest: { vitalKey: "rr", value: "18 / min" },
        arms: { vitalKey: "bp", value: "118/78 mmHg" },
        pelvis: { vitalKey: "keyInjury", value: "Mild dehydration, heat stress" },
        legs: null
      },
      hospitals: [
        {
          name: "AlUla Field Medical Base",
          meta: "Desert response unit",
          testsAvailable: [
            "Plain X-ray",
            "Intravenous (IV) fluids",
            "FAST ultrasound",
            "Urinalysis"
          ]
        },
        {
          name: "King Fahad Medical City ‚Äî Trauma Centre",
          meta: "Definitive care (if required)",
          testsAvailable: [
            "Plain X-ray",
            "CT scan",
            "ECG",
            "D-dimer"
          ]
        }
      ]
    },
    {
      id: "s4",
      label: "Scenario 4 ‚Äî Highway Collision (Black)",
      expectedScans: 6, // no BP image
      ai: {
        triage: "Black",
        hospital: "Dhahran Trauma Center",
        erTests: ["FAST ultrasound", "CT scan", "Blood typing and crossmatch"],
        timeSeconds: 1.3
      },
      vitalsBySlot: {
        eyes: { vitalKey: "consciousness", value: "Unresponsive, fixed pupils" },
        face: null,
        neck: { vitalKey: "hr", value: "No palpable pulse" },
        chest: { vitalKey: "rr", value: "No respiratory effort" },
        arms: null,
        pelvis: { vitalKey: "keyInjury", value: "Massive head and chest trauma" },
        legs: null
      },
      hospitals: [
        {
          name: "Dhahran Trauma Center",
          meta: "Highway critical care",
          testsAvailable: [
            "FAST ultrasound",
            "CT scan",
            "Blood typing and crossmatch",
            "D-dimer"
          ]
        },
        {
          name: "King Fahad Medical City ‚Äî Trauma Centre",
          meta: "Level 1 trauma, tertiary review",
          testsAvailable: [
            "FAST ultrasound",
            "CT scan",
            "Serum lactate",
            "D-dimer"
          ]
        }
      ]
    }
  ];

  const scenarioSelectEl = document.getElementById("scenarioSelect");
  const scanListEl = document.getElementById("scanList");
  const operatorLabelEl = document.getElementById("operatorLabel");
  const vConEl = document.getElementById("vConsciousness");
  const vRREl = document.getElementById("vRR");
  const vHREl = document.getElementById("vHR");
  const vBPEl = document.getElementById("vBP");
  const vKeyEl = document.getElementById("vKeyInjury");
  const timerDisplayEl = document.getElementById("timerDisplay");
  const timerHintEl = document.getElementById("timerHint");
  const continueBtn = document.getElementById("continueBtn");
  const submitDecisionBtn = document.getElementById("submitDecisionBtn");
  const decisionHintEl = document.getElementById("decisionHint");
  const resHumanTriage = document.getElementById("resHumanTriage");
  const resAITriage = document.getElementById("resAITriage");
  const resHumanHospital = document.getElementById("resHumanHospital");
  const resAIHospital = document.getElementById("resAIHospital");
  const resHumanTests = document.getElementById("resHumanTests");
  const resAITests = document.getElementById("resAITests");
  const resHumanTime = document.getElementById("resHumanTime");
  const resAITime = document.getElementById("resAITime");
  const matchTriage = document.getElementById("matchTriage");
  const matchHospital = document.getElementById("matchHospital");
  const matchTests = document.getElementById("matchTests");
  const matchTime = document.getElementById("matchTime");
  const scoreSummaryEl = document.getElementById("scoreSummary");
  const leaderboardBody = document.getElementById("leaderboardBody");
  const resetSimulationBtn = document.getElementById("resetSimulationBtn");
  const resetLeaderboardBtn = document.getElementById("resetLeaderboardBtn");
  const hospitalListEl = document.getElementById("hospitalList");
  const testsListEl = document.getElementById("testsList");

  const silhouetteBands = Array.from(document.querySelectorAll(".silhouette-band"));
  const silhouetteParts = {
    head: document.querySelector('.silhouette-part[data-part="head"]'),
    torso: document.querySelector('.silhouette-part[data-part="torso"]'),
    hips: document.querySelector('.silhouette-part[data-part="hips"]'),
    legs: document.querySelector('.silhouette-part[data-part="legs"]')
  };

  const triageCircles = Array.from(document.querySelectorAll(".triage-circle"));

  let currentScenario = scenarios[0];
  let scanState = {}; // slotId -> { scanned: bool }
  let scannedCount = 0;
  let allScansDone = false;
  let timerRunning = false;
  let timerStartMs = null;
  let finalTimeSeconds = null;
  let currentOperator = { name: "Unknown", mode: "Solo" };
  let selectedTriage = null;
  let selectedHospital = null;
  let selectedTests = new Set();
  let leaderboard = [];

  /* ---------- helpers ---------- */

  function resetVitals() {
    vConEl.textContent = "‚Äî";
    vRREl.textContent = "‚Äî";
    vHREl.textContent = "‚Äî";
    vBPEl.textContent = "‚Äî";
    vKeyEl.textContent = "‚Äî";
  }

  function applyVital(vitalKey, value) {
    if (!vitalKey) return;
    if (vitalKey === "consciousness") vConEl.textContent = value;
    if (vitalKey === "rr") vRREl.textContent = value;
    if (vitalKey === "hr") vHREl.textContent = value;
    if (vitalKey === "bp") vBPEl.textContent = value;
    if (vitalKey === "keyInjury") vKeyEl.textContent = value;
  }

  function resetTimer() {
    timerRunning = false;
    timerStartMs = null;
    finalTimeSeconds = null;
    timerDisplayEl.textContent = "0.00 s";
    timerHintEl.textContent =
      "Scan all QR tags on the mannequin. The timer will start when you continue to triage.";
  }

  function startTimer() {
    if (timerRunning) return;
    timerRunning = true;
    timerStartMs = performance.now();
    timerHintEl.textContent = "Timer running‚Ä¶ make your triage decision.";
    requestAnimationFrame(updateTimerLoop);
  }

  function stopTimer() {
    if (!timerRunning) return;
    timerRunning = false;
    const now = performance.now();
    finalTimeSeconds = (now - timerStartMs) / 1000;
    timerDisplayEl.textContent = finalTimeSeconds.toFixed(2) + " s (final)";
  }

  function updateTimerLoop() {
    if (!timerRunning) return;
    const now = performance.now();
    const elapsedSeconds = (now - timerStartMs) / 1000;
    timerDisplayEl.textContent = elapsedSeconds.toFixed(2) + " s";
    requestAnimationFrame(updateTimerLoop);
  }

  function clearSilhouette() {
    silhouetteBands.forEach(b => b.classList.remove("scanned"));
    Object.values(silhouetteParts).forEach(p => p.classList.remove("glow"));
  }

  function updateSilhouette() {
    // light bands in order of scanSlots based on scanState
    scanSlots.forEach((slot, idx) => {
      const band = silhouetteBands[idx];
      if (!band) return;
      if (scanState[slot.id]?.scanned) {
        band.classList.add("scanned");
      } else {
        band.classList.remove("scanned");
      }
    });

    // simple mapping: early scans -> head, then torso, hips, legs
    const ratio = scannedCount / currentScenario.expectedScans;
    Object.values(silhouetteParts).forEach(p => p.classList.remove("glow"));
    if (ratio > 0) silhouetteParts.head.classList.add("glow");
    if (ratio > 0.25) silhouetteParts.torso.classList.add("glow");
    if (ratio > 0.55) silhouetteParts.hips.classList.add("glow");
    if (ratio > 0.75) silhouetteParts.legs.classList.add("glow");
  }

  function resetScanState() {
    scanState = {};
    scanSlots.forEach(slot => {
      scanState[slot.id] = { scanned: false };
    });
    scannedCount = 0;
    allScansDone = false;
    clearSilhouette();
    timerHintEl.textContent =
      "Scan all QR tags on the mannequin. The timer will start when you continue to triage.";
    continueBtn.disabled = true;
    decisionHintEl.textContent = "Scan all regions, then continue to triage.";
  }

  function renderScanRows() {
    scanListEl.innerHTML = "";
    scanSlots.forEach(slot => {
      const row = document.createElement("div");
      row.className = "scan-row";
      row.dataset.slot = slot.id;
      row.innerHTML =
        '<div class="scan-row-header">' +
        '<div class="scan-label">' + slot.label + '</div>' +
        '<div class="scan-status">Waiting for scan‚Ä¶</div>' +
        "</div>";
      scanListEl.appendChild(row);
    });
  }

  function updateScanRow(slotId) {
    const row = scanListEl.querySelector('[data-slot="' + slotId + '"]');
    if (!row) return;
    const status = row.querySelector(".scan-status");
    if (scanState[slotId]?.scanned) {
      row.classList.add("scanned");
      status.textContent = "Scan received";
    } else {
      row.classList.remove("scanned");
      status.textContent = "Waiting for scan‚Ä¶";
    }
  }

  function parseScanFromUrl(url) {
    const lower = url.toLowerCase();
    const m = lower.match(/(s[1-4])_([a-z0-9]+)\.(jpg|jpeg|png)/);
    if (!m) return null;
    const scenarioId = m[1];
    const token = m[2]; // id, conclevel, hr, bp, rr, injury1, injury2
    let slotId = null;
    if (token.startsWith("id")) slotId = "eyes";
    else if (token.startsWith("conclevel")) slotId = "face";
    else if (token.startsWith("hr")) slotId = "neck";
    else if (token.startsWith("rr")) slotId = "chest";
    else if (token.startsWith("bp")) slotId = "arms";
    else if (token.startsWith("injury1")) slotId = "pelvis";
    else if (token.startsWith("injury2")) slotId = "legs";
    return { scenarioId, slotId };
  }

  function selectScenarioById(id) {
    const sc = scenarios.find(s => s.id === id) || scenarios[0];
    currentScenario = sc;
    scenarioSelectEl.value = sc.id;
    resetSimulationOnly();
  }

  function resetResults() {
    resHumanTriage.textContent = "‚Äî";
    resAITriage.textContent = "‚Äî";
    resHumanHospital.textContent = "‚Äî";
    resAIHospital.textContent = "‚Äî";
    resHumanTests.textContent = "‚Äî";
    resAITests.textContent = "‚Äî";
    resHumanTime.textContent = "‚Äî";
    resAITime.textContent = "‚Äî";
    [matchTriage, matchHospital, matchTests, matchTime].forEach(el => {
      el.textContent = "‚Äî";
      el.className = "match-cell";
    });
    scoreSummaryEl.innerHTML =
      'Score: <span class="points">0 / 12</span> points';
  }

  function resetDecision() {
    selectedTriage = null;
    selectedHospital = null;
    selectedTests = new Set();
    triageCircles.forEach(c => c.classList.remove("selected"));
    decisionHintEl.textContent = "Scan all regions, then continue to triage.";
    submitDecisionBtn.disabled = true;
    continueBtn.disabled = !allScansDone;
    renderHospitalsAndTests();
  }

  function markMatch(cell, ok) {
    cell.className = "match-cell " + (ok ? "match-yes" : "match-no");
    cell.textContent = ok ? "‚úÖ" : "‚ùå";
  }

  function renderHospitalsAndTests() {
    hospitalListEl.innerHTML = "";
    testsListEl.innerHTML = "";
    currentScenario.hospitals.forEach(h => {
      const card = document.createElement("div");
      card.className = "hospital-card";
      card.dataset.name = h.name;
      card.innerHTML =
        '<div class="hospital-name">' + h.name + "</div>" +
        '<div class="hospital-meta">' + h.meta + "</div>";
      card.addEventListener("click", () => {
        selectedHospital = h.name;
        Array.from(hospitalListEl.children).forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        renderTests(h.testsAvailable);
        updateSubmitEnabledState();
      });
      hospitalListEl.appendChild(card);
    });

    if (currentScenario.hospitals.length) {
      const first = currentScenario.hospitals[0];
      selectedHospital = first.name;
      const firstCard = hospitalListEl.querySelector('[data-name="' + first.name + '"]');
      if (firstCard) firstCard.classList.add("selected");
      renderTests(first.testsAvailable);
    } else {
      testsListEl.innerHTML =
        "<div style='font-size:12px;color:var(--muted);'>No ER tests configured.</div>";
    }
  }

  function renderTests(list) {
    testsListEl.innerHTML = "";
    selectedTests = new Set();
    list.forEach(name => {
      const pill = document.createElement("button");
      pill.type = "button";
      pill.className = "test-pill";
      pill.innerHTML = '<span class="dot"></span><span>' + name + "</span>";
      pill.dataset.test = name;
      pill.addEventListener("click", () => {
        if (selectedTests.has(name)) {
          selectedTests.delete(name);
          pill.classList.remove("selected");
        } else {
          selectedTests.add(name);
          pill.classList.add("selected");
        }
        updateSubmitEnabledState();
      });
      testsListEl.appendChild(pill);
    });
  }

  function updateSubmitEnabledState() {
    const ready =
      allScansDone &&
      selectedTriage &&
      selectedHospital &&
      selectedTests.size > 0;
    submitDecisionBtn.disabled = !ready;
    decisionHintEl.textContent = ready
      ? "Ready to submit. Compare your plan with the AI."
      : "Complete triage, hospital, and ER tests after all scans are done.";
  }

  function loadLeaderboard() {
    try {
      const raw = localStorage.getItem(LS_LEADERBOARD_KEY);
      if (!raw) return;
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) leaderboard = parsed;
    } catch (e) {
      console.error("Failed to load leaderboard", e);
    }
  }

  function saveLeaderboard() {
    try {
      localStorage.setItem(LS_LEADERBOARD_KEY, JSON.stringify(leaderboard));
    } catch (e) {
      console.error("Failed to save leaderboard", e);
    }
  }

  function renderLeaderboard() {
    leaderboardBody.innerHTML = "";
    leaderboard.forEach((entry, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML =
        "<td>" + (idx + 1) + "</td>" +
        "<td>" + entry.name + "</td>" +
        "<td>" + entry.mode + "</td>" +
        "<td>" + entry.scenario + "</td>" +
        "<td>" + entry.score + "</td>" +
        "<td>" + entry.time.toFixed(2) + " s</td>";
      leaderboardBody.appendChild(tr);
    });
  }

  function addToLeaderboard(human, score) {
    const entry = {
      name: currentOperator.name || "Unknown",
      mode: currentOperator.mode || "Solo",
      scenario: currentScenario.label,
      score: score,
      time: human.timeSeconds || 0
    };
    leaderboard.push(entry);
    leaderboard.sort((a, b) => {
      if (b.score !== a.score) return b.score - a.score;
      return a.time - b.time;
    });
    saveLeaderboard();
    renderLeaderboard();
  }

  /* ---------- event wiring ---------- */

  function resetSimulationOnly() {
    resetScanState();
    renderScanRows();
    Object.keys(scanState).forEach(updateScanRow);
    resetVitals();
    resetTimer();
    resetDecision();
    resetResults();
    updateSilhouette();
  }

  function resetSimulationAll() {
    resetSimulationOnly();
  }

  scenarioSelectEl.addEventListener("change", () => {
    selectScenarioById(scenarioSelectEl.value);
  });

  triageCircles.forEach(circle => {
    circle.addEventListener("click", () => {
      triageCircles.forEach(c => c.classList.remove("selected"));
      circle.classList.add("selected");
      selectedTriage = circle.dataset.level;
      updateSubmitEnabledState();
    });
  });

  continueBtn.addEventListener("click", () => {
    if (!allScansDone) return;
    continueBtn.disabled = true;
    startTimer();
    decisionHintEl.textContent =
      "Timer running. Make your triage decision, choose hospital and ER tests.";
  });

  submitDecisionBtn.addEventListener("click", () => {
    if (submitDecisionBtn.disabled) return;
    if (!allScansDone) return;
    stopTimer();
    const humanTime = finalTimeSeconds || 0;
    const human = {
      triage: selectedTriage,
      hospital: selectedHospital,
      tests: Array.from(selectedTests),
      timeSeconds: humanTime
    };
    showResults(human);
    addToLeaderboard(human, lastScoreComputed);
  });

  resetSimulationBtn.addEventListener("click", () => {
    resetSimulationAll();
  });

  resetLeaderboardBtn.addEventListener("click", () => {
    leaderboard = [];
    saveLeaderboard();
    renderLeaderboard();
  });

  socket.on("operator-info", info => {
    currentOperator = {
      name: info.name || "Visitor",
      mode: info.mode || "Solo"
    };
    operatorLabelEl.innerHTML =
      'Operator: <span class="glow">' +
      (currentOperator.name || "Visitor") +
      "</span> (" +
      (currentOperator.mode || "Solo") +
      ")";
  });

  // Fallback if mobile sends "operator-joined" only
  socket.on("operator-joined", info => {
    currentOperator = {
      name: info.name || "Visitor",
      mode: info.mode || "Solo"
    };
    operatorLabelEl.innerHTML =
      'Operator: <span class="glow">' +
      (currentOperator.name || "Visitor") +
      "</span> (" +
      (currentOperator.mode || "Solo") +
      ")";
  });

  socket.on("qr-scanned", payload => {
    const parsed = parseScanFromUrl(payload.url || "");
    if (!parsed || !parsed.slotId) return;

    // If scan belongs to a different scenario id than currently selected, ignore
    if (parsed.scenarioId && parsed.scenarioId !== currentScenario.id) {
      return;
    }

    const slotId = parsed.slotId;

    if (!scanState[slotId] || scanState[slotId].scanned) {
      return;
    }

    scanState[slotId].scanned = true;
    scannedCount++;
    updateScanRow(slotId);

    const vitCfg = currentScenario.vitalsBySlot[slotId];
    if (vitCfg) applyVital(vitCfg.vitalKey, vitCfg.value);

    updateSilhouette();

    if (!allScansDone && scannedCount >= currentScenario.expectedScans) {
      allScansDone = true;
      continueBtn.disabled = false;
      decisionHintEl.textContent =
        "All scans done. Press Continue to start the triage timer.";
      timerHintEl.textContent =
        "All scans collected. Press Continue to start the timer.";
    }

    updateSubmitEnabledState();
  });

  /* ---------- scoring ---------- */

  let lastScoreComputed = 0;

  function showResults(human) {
    const ai = currentScenario.ai;

    resHumanTriage.textContent = human.triage;
    resAITriage.textContent = ai.triage;
    resHumanHospital.textContent = human.hospital;
    resAIHospital.textContent = ai.hospital;
    resHumanTests.textContent = human.tests.join(", ");
    resAITests.textContent = ai.erTests.join(", ");

    const humanTime = human.timeSeconds || 0;
    resHumanTime.textContent = humanTime.toFixed(2) + " s";
    resAITime.textContent = ai.timeSeconds.toFixed(2) + " s";

    let score = 0;

    const triageMatch = human.triage === ai.triage;
    markMatch(matchTriage, triageMatch);
    if (triageMatch) score += 5;

    const hospitalMatch = human.hospital === ai.hospital;
    markMatch(matchHospital, hospitalMatch);
    if (hospitalMatch) score += 3;

    const aiSet = new Set(ai.erTests);
    const humanSet = new Set(human.tests);
    const testsMatch =
      ai.erTests.length === human.tests.length &&
      ai.erTests.every(t => humanSet.has(t));
    markMatch(matchTests, testsMatch);
    if (testsMatch) score += 2;

    const faster = human.timeSeconds && human.timeSeconds < ai.timeSeconds;
    markMatch(matchTime, faster);
    if (faster) score += 2;

    lastScoreComputed = score;

    const badgeText =
      score === 12
        ? "Perfect triage"
        : score >= 8
        ? "Safe triage"
        : score >= 4
        ? "Needs improvement"
        : "AI wins this round";

    scoreSummaryEl.innerHTML =
      'Score: <span class="points">' +
      score +
      " / 12</span> points" +
      '<span class="badge">' +
      badgeText +
      "</span>";
  }

  /* ---------- initialisation ---------- */

  function init() {
    scenarios.forEach(sc => {
      const opt = document.createElement("option");
      opt.value = sc.id;
      opt.textContent = sc.label;
      scenarioSelectEl.appendChild(opt);
    });
    renderScanRows();
    resetScanState();
    renderHospitalsAndTests();
    resetVitals();
    resetTimer();
    resetResults();

    loadLeaderboard();
    renderLeaderboard();
  }

  init();
</script>
</body>
</html>
