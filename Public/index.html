<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emergency Drone Simulation ‚Äì Main Screen</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: #e5e7eb;
      margin: 0;
      padding: 20px;
    }

    h1, h2, h3 { margin: 0.4rem 0; }

    .row {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1;
      min-width: 340px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 16px;
      padding: 18px 20px;
      box-shadow: 0 0 30px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .label {
      font-size: 0.85rem;
      text-transform: uppercase;
      color: #9ca3af;
      letter-spacing: 0.1em;
      margin-top: 10px;
      margin-bottom: 4px;
    }

    .value {
      font-size: 1.05rem;
      margin-bottom: 0.4rem;
    }

    .small { font-size: 0.8rem; color: #9ca3af; }

    .btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 8px;
      font-size: 0.95rem;
      font-weight: 500;
    }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-danger  { background: #b91c1c; color: #fff; }
    .btn-ghost   { background: transparent; color: #e5e7eb; border: 1px solid #4b5563; }

    .input, select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      margin-top: 4px;
    }

    .patient-layout {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 18px;
      align-items: flex-start;
    }

    .patient-photo {
      width: 100%;
      aspect-ratio: 3 / 4;
      border-radius: 16px;
      background: #020617;
      border: 1px solid #4b5563;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: #6b7280;
      overflow: hidden;
    }
    .patient-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .vital-slot {
      display: flex;
      justify-content: space-between;
      padding: 6px 8px;
      margin-bottom: 4px;
      border-radius: 8px;
      background: #020617;
      border: 1px solid #111827;
      font-size: 1.05rem;
    }

    .vital-label {
      color: #9ca3af;
    }

    .vital-value {
      font-weight: 600;
      color: #f9fafb;
    }

    .vital-value.empty {
      color: #4b5563;
    }

    .vital-highlight {
      animation: glow 900ms ease-out;
    }

    @keyframes glow {
      from { box-shadow: 0 0 0 rgba(248, 250, 252, 0.0); }
      50% { box-shadow: 0 0 18px rgba(248, 250, 252, 0.7); }
      to { box-shadow: 0 0 0 rgba(248, 250, 252, 0.0); }
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(37, 99, 235, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.5);
      color: #bfdbfe;
      margin-top: 6px;
    }

    .drone-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .drone-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 0.8rem;
      opacity: 0.35;
      transition: opacity 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
    }

    .drone-chip.active {
      opacity: 1;
      border-color: #22c55e;
      transform: translateY(-1px);
    }

    .timer-big {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .timer-ms {
      font-size: 1rem;
      opacity: 0.9;
    }

    .triage-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .triage-btn {
      border-radius: 12px;
      border: none;
      padding: 10px 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #020617;
    }

    .triage-btn span.sub {
      font-size: 0.8rem;
      font-weight: 400;
      opacity: 0.9;
    }

    .triage-btn.red    { background: #ef4444; }
    .triage-btn.yellow { background: #eab308; }
    .triage-btn.green  { background: #22c55e; }
    .triage-btn.black  { background: #111827; color: #f9fafb; }

    .choice-grid {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 20px;
      margin-top: 10px;
    }

    .hospital-card {
      border-radius: 12px;
      padding: 10px 12px;
      background: #020617;
      border: 1px solid #1f2937;
      margin-bottom: 8px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .hospital-card.selected {
      border-color: #22c55e;
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.5);
    }

    .hospital-name {
      font-weight: 600;
    }

    .tests-list label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      margin-top: 8px;
    }
    th, td {
      border-bottom: 1px solid #111827;
      padding: 6px 4px;
      text-align: left;
    }

    .score-highlight {
      font-size: 1.4rem;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <h1>üö® Emergency Drone Simulation ‚Äì Human vs AI Triage</h1>
  <p class="small">
    Step 1: Staff selects the team and scenario below. Step 2: Players scan QR tags using their phones.
    The main screen handles everything else automatically.
  </p>

  <!-- GAME SETUP -->
  <div class="card">
    <h2>üß≠ Scenario Setup</h2>
    <div class="row" style="margin-top:6px;">
      <div style="flex: 1; min-width: 240px;">
        <div class="label">Team name</div>
        <input id="teamNameInput" class="input" placeholder="Example: Hajj Medics A" />

        <div class="label">Mode</div>
        <select id="modeSelect">
          <option value="Group">Group</option>
          <option value="Solo">Solo</option>
        </select>
      </div>

      <div style="flex: 1; min-width: 260px;">
        <div class="label">Scenario</div>
        <select id="scenarioSelect"></select>

        <button class="btn btn-primary" id="startScenarioBtn">Start Scenario</button>
        <button class="btn btn-ghost" id="resetGameBtn">Reset Scenario</button>
        <button class="btn btn-danger" id="resetLeaderboardBtn">Reset Leaderboard</button>
        <div class="small" id="setupStatus" style="margin-top:6px;"></div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- LEFT: PATIENT + DRONE + VITALS -->
    <div class="card">
      <h2>üßë‚Äç‚öïÔ∏è Patient & Drone Feed</h2>

      <div class="patient-layout">
        <div>
          <div class="patient-photo" id="patientPhotoBox">
            <span class="small">Patient image will appear here.</span>
          </div>
          <div class="label">Scenario</div>
          <div class="value" id="scenarioNameDisplay">No active scenario.</div>

          <div class="label">Team</div>
          <div class="value" id="teamNameDisplay">‚Äì</div>

          <div id="droneStatus" class="status-pill" style="display:none;">
            <span>üõ∞Ô∏è Drone ready.</span>
          </div>
        </div>

        <div>
          <div class="label">Drone diagnostic tools</div>
          <div id="droneBar" class="drone-bar"></div>

          <div class="label">Vitals (live feed)</div>
          <div id="vitalsPanel">
            <!-- slots injected by JS -->
          </div>

          <div class="label">Triage timer</div>
          <div id="timerDisplay" class="timer-big">--</div>
          <div class="small" id="infoMessage" style="margin-top:4px;"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: TRIAGE / HOSPITAL / TESTS / RESULTS -->
    <div class="card" id="rightPanel">
      <h2 id="rightPanelTitle">üß© Human Triage</h2>
      <div id="rightPanelContent">
        <p class="small">Scan a vital QR tag to begin. The triage interface will unlock after all vitals are received.</p>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD -->
  <div class="card" style="margin-top:20px;">
    <h2>üèÜ Live Leaderboard</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Team</th>
          <th>Mode</th>
          <th>Scenario</th>
          <th>Score</th>
          <th>Time (s)</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </div>

  <script>
    const socket = io();

    let scenarios = [];
    let hospitalsMap = {};
    let currentGame = null;
    let timerInterval = null;
    let timerStart = null;
    let triageLocked = false;
    let hospitalSelection = null;
    let testSelection = new Set();
    let chosenTriage = null;

    const teamNameInput = document.getElementById("teamNameInput");
    const modeSelect = document.getElementById("modeSelect");
    const scenarioSelect = document.getElementById("scenarioSelect");
    const startScenarioBtn = document.getElementById("startScenarioBtn");
    const resetGameBtn = document.getElementById("resetGameBtn");
    const resetLeaderboardBtn = document.getElementById("resetLeaderboardBtn");
    const setupStatus = document.getElementById("setupStatus");

    const scenarioNameDisplay = document.getElementById("scenarioNameDisplay");
    const teamNameDisplay = document.getElementById("teamNameDisplay");
    const patientPhotoBox = document.getElementById("patientPhotoBox");
    const droneStatus = document.getElementById("droneStatus");
    const droneBar = document.getElementById("droneBar");
    const vitalsPanel = document.getElementById("vitalsPanel");
    const timerDisplayEl = document.getElementById("timerDisplay");
    const infoMessageEl = document.getElementById("infoMessage");
    const rightPanel = document.getElementById("rightPanel");
    const rightPanelTitle = document.getElementById("rightPanelTitle");
    const rightPanelContent = document.getElementById("rightPanelContent");
    const leaderboardBody = document.getElementById("leaderboardBody");

    const VITAL_LABELS = {
      hr: "Heart rate (HR)",
      bp: "Blood pressure (BP)",
      rr: "Respiratory rate (RR)",
      consciousness: "Consciousness",
      injury: "Key injury / problem"
    };

    const TESTS = {
      fast: "FAST ultrasound",
      lactate: "Serum lactate",
      crossmatch: "Blood typing and crossmatch",
      co: "Carboxyhaemoglobin level",
      xray: "Plain X-ray",
      burn: "Burn assessment",
      iv: "Intravenous (IV) fluids",
      ct: "CT scan"
    };

    const DRONE_ICON_SET = [
      "üî∂ Thermal imaging",
      "üü¶ FAST ultrasound module",
      "üü™ Pallor / skin perfusion analysis",
      "üü© Vital-sign sensor suite",
      "üü´ Facial recognition + GCS estimator"
    ];

    function resetVitalsPanel() {
      vitalsPanel.innerHTML = "";
      ["hr","bp","rr","consciousness","injury"].forEach(key => {
        const slot = document.createElement("div");
        slot.className = "vital-slot";
        slot.dataset.key = key;
        slot.innerHTML = `
          <span class="vital-label">${VITAL_LABELS[key]}</span>
          <span class="vital-value empty">‚Äî ‚Äî</span>
        `;
        vitalsPanel.appendChild(slot);
      });
    }

    function setPatientPhoto(photoUrl) {
      patientPhotoBox.innerHTML = "";
      if (photoUrl) {
        const img = document.createElement("img");
        img.src = photoUrl;
        img.alt = "Patient";
        patientPhotoBox.appendChild(img);
      } else {
        const span = document.createElement("span");
        span.className = "small";
        span.textContent = "Patient image will appear here.";
        patientPhotoBox.appendChild(span);
      }
    }

    function resetTimerDisplay() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = null;
      timerStart = null;
      timerDisplayEl.textContent = "--";
    }

    function startCountdown(seconds) {
      timerStart = performance.now();
      const endTime = timerStart + seconds * 1000;

      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const now = performance.now();
        let remaining = endTime - now;
        if (remaining <= 0) {
          remaining = 0;
          clearInterval(timerInterval);
          timerInterval = null;
        }
        const secFloat = remaining / 1000;
        const formatted = secFloat.toFixed(2);
        const [sec, ms] = formatted.split(".");
        timerDisplayEl.innerHTML =
          `<span class="timer-big">${sec}</span>` +
          `<span class="timer-ms">.${ms} s</span>`;
      }, 40);
    }

    function stopTimerFreezeFinal() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      if (timerStart !== null) {
        const elapsed = (performance.now() - timerStart) / 1000;
        const formatted = elapsed.toFixed(2);
        const [sec, ms] = formatted.split(".");
        timerDisplayEl.innerHTML =
          `<span class="timer-big">${sec}</span>` +
          `<span class="timer-ms">.${ms} s (final)</span>`;
      }
    }

    function buildDroneBar(textArray) {
      droneBar.innerHTML = "";
      (textArray || DRONE_ICON_SET).forEach(t => {
        const chip = document.createElement("div");
        chip.className = "drone-chip";
        chip.textContent = t;
        droneBar.appendChild(chip);
      });
    }

    function activateDroneChip(index) {
      const chips = Array.from(droneBar.children);
      if (chips[index]) {
        chips[index].classList.add("active");
      }
    }

    function showTriageButtons() {
      rightPanelTitle.textContent = "üö® Step 4 ‚Äî Choose the triage category";
      rightPanelContent.innerHTML = `
        <p class="small">Use the vitals and drone diagnostics on the left to decide how urgent this patient is.</p>
        <div class="triage-grid">
          <button class="triage-btn red" data-triage="Red">
            <span>üü• Red</span>
            <span class="sub">Immediate ‚Äì life-threatening</span>
          </button>
          <button class="triage-btn yellow" data-triage="Yellow">
            <span>üü® Yellow</span>
            <span class="sub">Urgent ‚Äì can tolerate short delay</span>
          </button>
          <button class="triage-btn green" data-triage="Green">
            <span>üü© Green</span>
            <span class="sub">Minimal ‚Äì walking wounded</span>
          </button>
          <button class="triage-btn black" data-triage="Black">
            <span>‚¨õ Black</span>
            <span class="sub">Expectant / deceased</span>
          </button>
        </div>
      `;

      document.querySelectorAll(".triage-btn").forEach(btn => {
        btn.onclick = () => {
          if (triageLocked) return;
          chosenTriage = btn.dataset.triage;
          triageLocked = true;
          showHospitalAndTests();
        };
      });
    }

    function showHospitalAndTests() {
      rightPanelTitle.textContent = "üè• Step 5 ‚Äî Choose hospital & ER tests";
      const currentScenario = scenarios.find(s => s.id === (currentGame?.scenarioId || 0));

      rightPanelContent.innerHTML = `
        <div class="choice-grid">
          <div>
            <div class="label">Receiving hospital</div>
            <div id="hospitalList"></div>
          </div>
          <div>
            <div class="label">Emergency department tests</div>
            <div class="tests-list" id="testsList"></div>
          </div>
        </div>
        <button class="btn btn-primary" id="confirmChoicesBtn" style="margin-top:12px;">Confirm choices</button>
        <div class="small" id="choiceStatus" style="margin-top:4px;"></div>
      `;

      const hospitalList = document.getElementById("hospitalList");
      const testsList = document.getElementById("testsList");
      const choiceStatus = document.getElementById("choiceStatus");

      hospitalList.innerHTML = "";
      Object.entries(hospitalsMap).forEach(([id, label]) => {
        const card = document.createElement("div");
        card.className = "hospital-card";
        card.dataset.hospitalId = id;
        card.innerHTML = `<div class="hospital-name">${label}</div>`;
        card.onclick = () => {
          hospitalSelection = id;
          document.querySelectorAll(".hospital-card").forEach(c => c.classList.remove("selected"));
          card.classList.add("selected");
        };
        hospitalList.appendChild(card);
      });

      testsList.innerHTML = "";
      Object.entries(TESTS).forEach(([id, label]) => {
        const lab = document.createElement("label");
        lab.innerHTML = `<input type="checkbox" data-test-id="${id}"> ${label}`;
        testsList.appendChild(lab);
      });

      document.querySelectorAll('input[data-test-id]').forEach(box => {
        box.onchange = () => {
          const id = box.dataset.testId;
          if (box.checked) testSelection.add(id);
          else testSelection.delete(id);
        };
      });

      document.getElementById("confirmChoicesBtn").onclick = () => {
        if (!hospitalSelection) {
          choiceStatus.textContent = "Please select a receiving hospital.";
          return;
        }
        if (!chosenTriage) {
          choiceStatus.textContent = "Triage selection missing.";
          return;
        }
        socket.emit("submitHumanDecision", {
          triage: chosenTriage,
          hospitalId: hospitalSelection,
          testIds: Array.from(testSelection)
        });
        choiceStatus.textContent = "Decisions sent. Analysing against AI...";
      };
    }

    function showResults(result) {
      rightPanelTitle.textContent = "ü§ñ Step 6 ‚Äî Human vs AI comparison";
      const rows = [
        {
          label: "Triage category",
          human: result.human.triage,
          ai: result.ai.triage,
          match: result.human.triage === result.ai.triage ? "‚úÖ" : "‚ùå"
        },
        {
          label: "Receiving hospital",
          human: result.human.hospitalLabel,
          ai: result.ai.hospitalLabel,
          match: result.human.hospitalLabel === result.ai.hospitalLabel ? "‚úÖ" : "‚ùå"
        },
        {
          label: "ER tests",
          human: result.human.testLabels.join(", ") || "None selected",
          ai: result.ai.testLabels.join(", ") || "None",
          match: result.human.testLabels.length === result.ai.testLabels.length &&
                 result.human.testLabels.every(t => result.ai.testLabels.includes(t)) ? "‚úÖ" : "‚ùå"
        },
        {
          label: "Decision time",
          human: `${result.human.timeSeconds.toFixed(2)} s`,
          ai: `${result.ai.aiTimeSeconds.toFixed(2)} s`,
          match: result.human.timeSeconds < result.ai.aiTimeSeconds ? "‚ö° Faster than AI" : "‚è± AI faster"
        }
      ];

      rightPanelContent.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th>Human team</th>
              <th>AI drone</th>
              <th>Match</th>
            </tr>
          </thead>
          <tbody>
            ${rows
              .map(
                r => `<tr>
                  <td>${r.label}</td>
                  <td>${r.human}</td>
                  <td>${r.ai}</td>
                  <td>${r.match}</td>
                </tr>`
              )
              .join("")}
          </tbody>
        </table>

        <div class="label" style="margin-top:10px;">Score summary</div>
        <div class="score-highlight">${result.scoreBreakdown.total} / 12 points</div>
        <p class="small">
          Correct triage <strong>+5</strong> ‚Ä¢ Correct hospital <strong>+3</strong> ‚Ä¢ Correct ER tests <strong>+3</strong> ‚Ä¢ Faster than AI <strong>+1</strong>
        </p>

        <h3 style="margin-top:12px;">üß† Why the AI chose this plan</h3>
        <p><strong>Triage:</strong> ${result.explanations.triage}</p>
        <p><strong>Tests:</strong> ${result.explanations.tests}</p>
        <p><strong>Treatment logic:</strong> ${result.explanations.treatment}</p>
      `;
    }

    // --- SOCKET HANDLERS ---

    socket.on("stateUpdate", data => {
      scenarios = data.scenarios || [];
      hospitalsMap = data.hospitals || hospitalsMap;
      currentGame = data.currentGame;

      // Populate scenario dropdown
      scenarioSelect.innerHTML = "";
      scenarios.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.textContent = `${s.id}. ${s.name}`;
        scenarioSelect.appendChild(opt);
      });

      // Leaderboard
      leaderboardBody.innerHTML = "";
      (data.leaderboard || []).forEach((entry, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${entry.playerName}</td>
          <td>${entry.mode}</td>
          <td>${entry.scenarioShort}</td>
          <td>${entry.points}</td>
          <td>${entry.timeSeconds.toFixed(2)}</td>
        `;
        leaderboardBody.appendChild(tr);
      });

      if (!currentGame) {
        scenarioNameDisplay.textContent = "No active scenario.";
        teamNameDisplay.textContent = "‚Äì";
        setPatientPhoto(null);
        resetVitalsPanel();
        buildDroneBar([]);
        droneStatus.style.display = "none";
        resetTimerDisplay();
        rightPanelTitle.textContent = "üß© Human Triage";
        rightPanelContent.innerHTML =
          "<p class='small'>Start a scenario above, then ask players to scan QR tags with their phones.</p>";
        return;
      }

      scenarioNameDisplay.textContent = currentGame.scenarioName;
      teamNameDisplay.textContent = currentGame.playerName;
      setPatientPhoto(currentGame.patientPhoto);
      resetVitalsPanel();
      buildDroneBar(currentGame.droneTestsText);
      droneStatus.style.display = "inline-flex";
      droneStatus.textContent = "üõ∞Ô∏è Waiting for first vital scan‚Ä¶";
      infoMessageEl.textContent = "Scan any patient tag to begin.";
    });

    socket.on("droneLoading", payload => {
      if (!currentGame || !payload || payload.scenarioId !== currentGame.scenarioId) return;
      droneStatus.style.display = "inline-flex";
      droneStatus.textContent = "üõ∞Ô∏è Drone identifying patient‚Ä¶";

      setTimeout(() => {
        droneStatus.textContent = "üì° Receiving sensor data‚Ä¶";
      }, 800);
      setTimeout(() => {
        droneStatus.textContent = "üñ• Preparing visual feed‚Ä¶";
      }, 1600);
      setTimeout(() => {
        droneStatus.textContent = "‚úÖ Patient link established.";
      }, 2400);
    });

    socket.on("vitalScanned", payload => {
      const slot = vitalsPanel.querySelector(`.vital-slot[data-key="${payload.vitalKey}"]`);
      if (slot) {
        const valSpan = slot.querySelector(".vital-value");
        valSpan.textContent = payload.vitalValue;
        valSpan.classList.remove("empty");
        slot.classList.add("vital-highlight");
        setTimeout(() => slot.classList.remove("vital-highlight"), 900);
      }

      // Activate drone icon sequence
      activateDroneChip(payload.count - 1);

      const phrases = [
        "Vital 1 scanned ‚Äî continue.",
        "Vital 2 scanned ‚Äî keep going.",
        "Vital 3 scanned ‚Äî almost there.",
        "Vital 4 scanned ‚Äî one more left!",
        "All vitals scanned ‚Äî look at the big screen!"
      ];
      infoMessageEl.textContent = phrases[Math.min(payload.count - 1, phrases.length - 1)];
    });

    socket.on("allVitalsCollected", payload => {
      infoMessageEl.textContent =
        "üö® All vitals received. Make your triage decision on this screen.";
      startCountdown(payload.triageTimerSeconds || 60);
      triageLocked = false;
      chosenTriage = null;
      hospitalSelection = null;
      testSelection = new Set();
      showTriageButtons();
    });

    socket.on("resultsReady", result => {
      stopTimerFreezeFinal();
      showResults(result);
    });

    // --- BUTTONS ---

    startScenarioBtn.onclick = () => {
      const teamName = teamNameInput.value.trim() || "Guest Team";
      const mode = modeSelect.value;
      const scenarioId = parseInt(scenarioSelect.value, 10);

      if (!scenarioId) {
        setupStatus.textContent = "Please select a scenario.";
        return;
      }

      socket.emit("registerPlayer", { playerName: teamName, mode, scenarioId });
      setupStatus.textContent = "Scenario started. Ask players to scan the patient tags.";
    };

    resetGameBtn.onclick = () => {
      socket.emit("resetGame");
    };

    resetLeaderboardBtn.onclick = () => {
      socket.emit("resetLeaderboard");
    };
  </script>
</body>
</html>
