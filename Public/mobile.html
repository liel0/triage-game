<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Drone Scanner â€“ Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  background: #020617;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  padding: 16px;
}
h1 {
  font-size: 20px;
  margin-bottom: 8px;
}
label {
  font-size: 14px;
}
input, select, button {
  width: 100%;
  margin-top: 6px;
  margin-bottom: 12px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #334155;
  background: #0f172a;
  color: #e5e7eb;
}
button {
  background: #16a34a;
  border: none;
  font-weight: 600;
}
button:active {
  transform: scale(0.98);
}
#status {
  margin-top: 10px;
  font-size: 14px;
}
#reader {
  margin-top: 14px;
  width: 100%;
  max-width: 420px;
  margin-inline: auto;
}
.badge {
  display: inline-block;
  padding: 4px 10px;
  background: #1f2937;
  border-radius: 999px;
  font-size: 12px;
  margin-bottom: 6px;
}
</style>

<!-- html5-qrcode -->
<script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>
<!-- socket.io -->
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<h1>ðŸ“± Drone Scanner</h1>
<div class="badge">Step 1 â€” Enter name & mode</div>

<label for="nameInput">Visitor or team name</label>
<input id="nameInput" type="text" placeholder="e.g. Trauma Team A" />

<label for="modeSelect">Mode</label>
<select id="modeSelect">
  <option value="Solo">Solo</option>
  <option value="Group">Group</option>
</select>

<button id="startBtn">Start scanning</button>

<div id="status">Scanner not started yet.</div>

<div id="reader"></div>

<script>
const socket = io();

let operatorName = "";
let operatorMode = "Solo";
let scanner = null;

function sendOperatorInfo() {
  socket.emit("operatorInfo", {
    name: operatorName,
    mode: operatorMode
  });
}

document.getElementById("startBtn").addEventListener("click", () => {
  operatorName = document.getElementById("nameInput").value.trim() || "Visitor";
  operatorMode = document.getElementById("modeSelect").value || "Solo";

  sendOperatorInfo();

  document.getElementById("status").textContent =
    `Scanner ready. Operator: ${operatorName} (${operatorMode}). Point camera at a QR tag.`;

  if (scanner) return; // already running

  scanner = new Html5Qrcode("reader");

  const config = {
    fps: 10,
    qrbox: { width: 260, height: 260 }
  };

  scanner.start(
    { facingMode: "environment" },
    config,
    onScanSuccess,
    onScanFailure
  );
});

function onScanSuccess(decodedText, decodedResult) {
  // Do NOT open the URL on the phone â€“ only send it to the big screen
  document.getElementById("status").textContent =
    `Tag scanned. Sending to main screenâ€¦`;

  socket.emit("scan", {
    qrText: decodedText,
    operatorName,
    mode: operatorMode
  });
}

function onScanFailure(error) {
  // ignore; keeps scanner running smoothly
}
</script>

</body>
</html>
